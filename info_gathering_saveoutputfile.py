import sys
import dns.resolver
import shodan
import requests
import whois
import argparse
import socket

argparse = argparse.ArgumentParser(description="This is a basic information gathering toll.",usage="python3 info_gathering.py -d Domain [-s IP]")
argparse.add_argument("-d", "--domain", help="Enter domain name for footprinting")
argparse.add_argument("-s", "--shodan", help="Enter the IP for shodan search ")
argparse.add_argument("-o","--output",help="Enter the file to write output to.")

args = argparse.parse_args()
domain = args.domain
ip = args.shodan
output=args.output

# whois module
print("[+]Getting whois info...")

whois_result=''

# using whois library, creating instance
try:
    py = whois.query(domain)
    print("[+]whois info found.")
    whois_result+="Name:{}".format(py.name) +'\n'
    whois_result+="Registrar:{}".format(py.registrar) +'\n'
    whois_result+="Creating Date:{}".format(py.creation_date) +'\n'
    whois_result+="Expiration Date:{}".format(py.expiration_date) +'\n'
    whois_result+="Registrant:{}".format(py.registrant) +'\n'
    whois_result+="Registrant Country:{}".format(py.registrant_country) +'\n'
    whois_result+="Email:{}".format(py.emails) +'\n'
    whois_result+="Server name:{}".format(py.name_servers) +'\n'
except:
    pass
print(whois_result)

# DNS module

print("[+] Getting DNS info...")
dns_result = ''

# implementing dns.resolver from dnspython
try:
    for a in dns.resolver.resolve(domain, 'A'):
        dns_result += "[+] A record:{}".format(a.to_text()) + '\n'

    for ns in dns.resolver.resolve(domain, 'NS'):
        dns_result += "[+] NS record:{}".format(ns.to_text()) + '\n'

    for mx in dns.resolver.resolve(domain, 'MX'):
        dns_result += "[+] MX record:{}".format(mx.to_text()) + '\n'

    for txt in dns.resolver.resolve(domain, 'TXT'):
        dns_result += "[+] TXT record:{}".format(txt.to_text()) + '\n'
except:
    pass
print(dns_result)

# Geolocation module

print("[+] Getting geolocation info....")
geo_result = ''

# implementing request for web request
try:
    response = requests.request('Get', "https://www.geolocation-db.com/json/" + socket.gethostbyname(domain)).json()
    geo_result += "[+] Country:{}".format(response['country_name']) + '\n'
    # print("[+] Lattitude:{}".format(response['lattitude']))
    geo_result += "[+] Longitude:{}".format(response['longitude']) + '\n'
    geo_result += "[+] City:{}".format(response['city']) + '\n'
    geo_result += "[+] State:{}".format(response['state']) + '\n'
except:
    pass
print(geo_result)

# Shodan module
if ip:
    print("[+] Getting info from Shodan for IP {}".format(ip))
    # Shodan API
    api = shodan.Shodan("YqiAvMgGyWE3OKc9g1wBVSv6ApQGkBH0")
    try:
        results = api.search(ip)
        print("[+] Result found: {}".format(results['total']))
        for result in results['matcches']:
            print("[+] IP: {}".format(result['ip_str']))
            print("[+] Data: \n{}".format(result['data']))
            print()
    except:
        print("[-]Shodan search error.")

if (output):
    with open(output, 'w') as file:
        file.write(whois_result + '\n\n')
        file.write(dns_result + '\n\n')
        file.write(geo_result + '\n\n')

