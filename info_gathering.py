import sys
import dns.resolver
import shodan
import requests
import whois
import argparse
import socket

argparse=argparse.ArgumentParser(description="This is a basic information gathering toll.",usage="python3 info_gathering.py -d Domain [-s IP]")
argparse.add_argument("-d","--domain",help="Enter domain name for footprinting")
argparse.add_argument("-s","--shodan",help="Enter the IP for shodan search ")

args = argparse.parse_args()
domain=args.domain
ip=args.shodan


#whois module
print("[+]Getting whois info...")


#using whois library, creating instance
try:
    py= whois.query(domain)
    print("[+]whois info found.")
    print("Name:{}".format(py.name))
    print("Registrar:{}".format(py.registrar))
    print("Creating Date:{}".format(py.creation_date))
    print("Expiration Date:{}".format(py.expiration_date))
    print("Registrant:{}".format(py.registrant))
    print("Registrant Country:{}".format(py.registrant_country))
    print("Email:{}".format(py.emails))
    print("Server name:{}".format(py.name_servers))
except:
    pass

# DNS module

print("[+] Getting DNS info...")

# implementing dns.resolver from dnspython
try:
    for a in dns.resolver.resolve(domain,'A'):
        print("[+] A record:{}".format(a.to_text()))

    for ns in dns.resolver.resolve(domain, 'NS'):
        print("[+] NS record:{}".format(ns.to_text()))

    for mx in dns.resolver.resolve(domain, 'MX'):
        print("[+] MX record:{}".format(mx.to_text()))

    for txt in dns.resolver.resolve(domain, 'TXT'):
            print("[+] TXT record:{}".format(txt.to_text()))
except:
    pass


# Geolocation module

print("[+] Getting geolocation info....")


# implementing request for web request
try:
    response = requests.request('Get',"https://www.geolocation-db.com/json/"+ socket.gethostbyname(domain)).json()
    print("[+] Country:{}".format(response['country_name']))
    #print("[+] Lattitude:{}".format(response['lattitude']))
    print("[+] Longitude:{}".format(response['longitude']))
    print("[+] City:{}".format(response['city']))
    print("[+] State:{}".format(response['state']))
except:
    pass


# Shodan module 
if ip:
    print("[+] Getting info from Shodan for IP {}".format(ip))
    #Shodan API
    api=shodan.Shodan("YqiAvMgGyWE3OKc9g1wBVSv6ApQGkBH0")
    try:
        results = api.search(ip)
        print("[+] Result found: {}".format(results['total']))
        for result in results['matcches']:
            print("[+] IP: {}".format(result['ip_str']))
            print("[+] Data: \n{}".format(result['data']))
            print()
    except:
        print("[-]Shodan search error.")



